<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malaysian Street Food Exploration</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.0.0/css/flag-icons.min.css"/>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .navbar-nav .nav-link:hover {
            color: white !important;
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .navbar-toggler {
            border: none;
            color: white !important;
        }
        
        .navbar-toggler:focus {
            box-shadow: none;
        }

        .card {
            border-radius: 15px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            border: none;
            margin-bottom: 20px;
            background-color: #fde8d8; 
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .card-img-container {
            position: relative;
            width: 100%;
            overflow: hidden;
        }
        .card-img-top {
            height: 200px;
            object-fit: cover;
            display: block;
            background-color: #f0f0f0;
            background-image: linear-gradient(90deg, #f0f0f0, #e0e0e0, #f0f0f0);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        .price-tag {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.9);
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
            color: #fc0101; 
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        .food-title {
            font-weight: 700;
            color: #2d334a;
            font-size: 1.2rem;
        }
        .food-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
            background-color: #f8f3eb; 
            border-radius: 0 0 15px 15px;
        }
        .food-details.show {
            max-height: 1000px;
        }
        .like-btn {
            color: #000000; 
            cursor: pointer;
            transition: color 0.3s;
        }
        .like-btn.active {
            color: #d70000; 
        }
        .section-title {
            position: relative;
            padding-bottom: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        .section-title:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: #D16002;
        }
        .hero-section {
            background: url('https://images.unsplash.com/photo-1504674900247-0877df9cc836?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80') center/cover no-repeat;
            padding: 100px 0;
            color: white;
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }
        .hero-section:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
        }
        .hero-content {
            position: relative;
            z-index: 1;
        }
        .image-nav {
            position: absolute;
            top: 50%;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transform: translateY(-50%);
            padding: 0 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .card:hover .image-nav {
            opacity: 1;
        }
        .image-nav button {
            background: rgba(0, 0, 0, 0.5);
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .toggle-details {
            color: #D16002 !important;
            border-color: #D16002 !important;
        }
        .toggle-details:hover {
            background-color: #D16002 !important;
            color: white !important;
        }
        
        .hero-content .form-select {
            max-width: 400px; 
            margin: 20px auto 0;
            border: none;
            padding: 10px 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .map-link {
            display: inline-block;
            margin-top: 15px;
            padding: 8px 15px;
            background-color: #4285F4;
            color: white;
            border-radius: 4px;
            text-decoration: none;
            transition: background-color 0.3s;
        }
        .map-link:hover {
            background-color: #3367D6;
            color: white;
        }
        .map-link i {
            margin-right: 5px;
        }
        .share-btn-group {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        .share-btn {
            font-size: 1.2rem;
            color: #fff;
            padding: 8px 15px;
            border-radius: 5px;
            transition: transform 0.2s;
            background-color: #D16002;
            border: none;
            cursor: pointer;
        }
        .share-btn:hover {
            background-color: #ac4e02;
            transform: scale(1.05);
        }
        
        .recommended-places {
            margin-top: 15px;
        }
        .place-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .place-item:last-child {
            border-bottom: none;
        }

        #controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            max-width: 600px;
            margin: 20px auto;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top" style="background-color: #D16002; padding: 0.8rem 1rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <div class="container">
            <a class="navbar-brand" href="index.html" style="font-weight: 700; font-size: 1.5rem; color: white !important;">
                <i class="fas fa-utensils me-2"></i>Streets of Food
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html" style="color: rgba(255, 255, 255, 0.85) !important; font-weight: 500; padding: 0.5rem 1rem; margin: 0 0.1rem; border-radius: 4px; transition: all 0.3s ease;">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="About.html" style="color: rgba(255, 255, 255, 0.85) !important; font-weight: 500; padding: 0.5rem 1rem; margin: 0 0.1rem; border-radius: 4px; transition: all 0.3s ease;">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="Malaysia.html" style="color: white !important; background-color: #A54D00; font-weight: 500; padding: 0.5rem 1rem; margin: 0 0.1rem; border-radius: 4px; transition: all 0.3s ease;">Malaysia</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Global.html" style="color: rgba(255, 255, 255, 0.85) !important; font-weight: 500; padding: 0.5rem 1rem; margin: 0 0.1rem; border-radius: 4px; transition: all 0.3s ease;">Global</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Event.html" style="color: rgba(255, 255, 255, 0.85) !important; font-weight: 500; padding: 0.5rem 1rem; margin: 0 0.1rem; border-radius: 4px; transition: all 0.3s ease;">Events</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Recipe.html" style="color: rgba(255, 255, 255, 0.85) !important; font-weight: 500; padding: 0.5rem 1rem; margin: 0 0.1rem; border-radius: 4px; transition: all 0.3s ease;">Recipe</a>
                    <li class="nav-item">
                        <a class="nav-link" href="Quiz.html" style="color: rgba(255, 255, 255, 0.85) !important; font-weight: 500; padding: 0.5rem 1rem; margin: 0 0.1rem; border-radius: 4px; transition: all 0.3s ease;">Quiz</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Team.html" style="color: rgba(255, 255, 255, 0.85) !important; font-weight: 500; padding: 0.5rem 1rem; margin: 0 0.1rem; border-radius: 4px; transition: all 0.3s ease;">Team</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Team.html#feedbackSection" style="color: rgba(255, 255, 255, 0.85) !important; font-weight: 500; padding: 0.5rem 1rem; margin: 0 0.1rem; border-radius: 4px; transition: all 0.3s ease;">Feedback</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="hero-section">
        <div class="hero-content">
            <div class="container">
                <h1 class="display-4 fw-bold">Explore Malaysian Street Food</h1>
                <p class="lead">From Penang's Char Kway Teow to Kuala Lumpur's Nasi Lemak, experience authentic flavors.</p>
                <div id="controls">
                    <select id="ethnicitySelect" class="form-select">
                        <option value="">All Cuisines</option>
                        <option value="Malay">Malay Cuisine</option>
                        <option value="Chinese">Chinese Cuisine</option>
                        <option value="Indian">Indian Cuisine</option>
                        <option value="Peranakan">Peranakan Cuisine</option>
                    </select>
                    <button id="myFavoritesBtn" class="btn btn-outline-light d-flex align-items-center">
                        <i class="fas fa-heart me-2"></i>My Favorites
                    </button>
                    <button id="viewAllBtn" class="btn btn-outline-light d-none align-items-center">
                        View All Foods
                    </button>
                </div>
            </div>
        </div>
    </div>

    <main class="container">
        <section id="malaysian" class="my-5">
            <h2 class="section-title">Malaysian Street Food</h2>
            <div class="row" id="food-container">
            </div>
        </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        const foods = [
            {
                id: 1,
                name: "Nasi Lemak",
                ethnicity: "Malay",
                price: "RM 5-10",
                images: [
                    "myfoodimages/nasilemak1.jpg",
                    "myfoodimages/nasilemak2.jpg"
                ],
                description: "Nasi Lemak is Malaysia's national dish, famous for its unique texture and rich combination of flavors. The main components are rice cooked in coconut milk, served with a spicy chili paste (Sambal), fried fish, crispy anchovies, roasted peanuts, cucumber slices, and a half-boiled egg. The distinctive coconut milk flavor makes the rice incredibly delicious.",
                recommendedPlaces: [
                    {
                        name: "Village Park Restaurant",
                        address: "5, Jalan SS 21/37, Damansara Utama, 47400 Petaling Jaya, Selangor",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Village+Park+Restaurant+Damansara+Utama+Selangor"
                    }
                ]
            },
            {
                id: 2,
                name: "Char Kway Teow",
                ethnicity: "Chinese",
                price: "RM 6-12",
                images: [
                    "myfoodimages/kwayteow1.jpg",
                    "myfoodimages/kwayteow2.jpg",
                    "myfoodimages/kwayteow3.jpg"
                ],
                description: "Penang Char Kway Teow is a famous fried noodle dish from Penang. The flat rice noodles are stir-fried with a special sauce, scallions, bean sprouts, chili paste, eggs, prawns, and clams, creating a dish that is savory, aromatic, and full of flavor.",
                recommendedPlaces: [
                    {
                        name: "Siam Road Char Koay Teow",
                        address: "82, Jalan Siam, 10400 George Town, Pulau Pinang",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Siam+Road+Char+Koay+Teow+82+Jalan+Siam+George+Town"
                    }
                ]
            },
            {
                id: 3,
                name: "Roti Canai",
                ethnicity: "Indian",
                price: "RM 2-5",
                images: [
                    "myfoodimages/roticanai1.jpg",
                    "myfoodimages/roticanai2.jpg",
                    "myfoodimages/roticanai3.jpg"
                ],
                description: "Roti Canai is a popular Malaysian flatbread made from flour, water, salt, and butter. The dough is stretched and folded to create a layered, flaky texture, then pan-fried until golden and crispy on both sides. It is often served with a side of curry or dal.",
                recommendedPlaces: [
                    {
                        name: "Valentine Roti Canai",
                        address: "Jalan Sayur, Off Jalan Masjid India, 50100 Kuala Lumpur",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Valentine+Roti+Jalan+Sultan+Yahya+Petra+Kuala+Lumpur"
                    }
                ]
            },
            {
                id: 4,
                name: "Laksa",
                ethnicity: "Peranakan",
                price: "RM 8-15",
                images: [
                    "myfoodimages/laksa1.jpg",
                    "myfoodimages/laksa2.jpg"
                ],
                description: "Laksa features a rich and flavorful broth, filled with fish and paired with a special laksa paste, fresh mint leaves, cucumber, red onion, pineapple, and chili. These ingredients create a complex and multi-layered taste, making it a truly unforgettable dish.",
                recommendedPlaces: [
                    {
                        name: "Air Itam Laksa (Pasar Air Itam)",
                        address: "Jalan Pasar, 11500 Ayer Itam, Pulau Pinang",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Air+Itam+Laksa+Jalan+Pasar+Ayer+Itam+Penang"
                    }
                ]
            },
            {
                id: 5,
                name: "Satay",
                ethnicity: "Malay",
                price: "RM 0.8-1.5 per stick",
                images: [
                    "myfoodimages/satay1.jpg",
                    "myfoodimages/satay2.jpg",
                    "myfoodimages/satay3.jpg"
                ],
                description: "Satay is a quintessential Malaysian barbecue delight. Skewers of marinated chicken, beef, or lamb are grilled over charcoal until they are perfectly crisp and juicy. It's served with a rich and savory peanut sauce, which makes it an addictive and memorable treat.",
                recommendedPlaces: [
                    {
                        name: "Sate Kajang Haji Samuri (Medan Sate Kajang)",
                        address: "Medan Sate, Jalan Mendaling, 43000 Kajang, Selangor",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Sate+Kajang+Hj+Samuri+Medan+Sate+Kajang"
                    }
                ]
            },
            {
                id: 6,
                name: "Bak Kut Teh",
                ethnicity: "Chinese",
                price: "RM 12-20",
                images: [
                    "myfoodimages/bakkutteh1.jpg",
                    "myfoodimages/bakkutteh2.jpg"
                ],
                description: "Bak Kut Teh is a Chinese herbal soup with Fujian roots. It's made by simmering pork ribs with various herbs and spices for a long time, resulting in a robust, flavorful broth and tender meat. It is often enjoyed with rice, fried dough fritters, and pickled vegetables.",
                recommendedPlaces: [
                    {
                        name: "Seng Huat Bak Kut Teh (“Under the Bridge”, Klang)",
                        address: "9, Jalan Sultan, Kawasan 1, 41000 Klang, Selangor",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Seng+Huat+Bak+Kut+Teh+9+Jalan+Sultan+Klang"
                    }
                ]
            },
            {
                id: 7,
                name: "Cendol",
                ethnicity: "Malay",
                price: "RM 3-7",
                images: [
                    "myfoodimages/cendol1.jpg",
                    "myfoodimages/cendol2.jpg"
                ],
                description: "Cendol is a refreshing Malaysian cold dessert made with green rice flour jelly, coconut milk, red beans, and palm sugar syrup. It's a sweet and creamy treat that is perfect for beating the tropical heat.",
                recommendedPlaces: [
                    {
                        name: "Penang Road Famous Teochew Chendul (Lebuh Keng Kwee)",
                        address: "27 & 29, Lebuh Keng Kwee, 10100 George Town, Pulau Pinang",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Penang+Road+Famous+Teochew+Chendul+Lebuh+Keng+Kwee"
                    }
                ]
            },
            {
                id: 8,
                name: "Hokkien Mee",
                ethnicity: "Chinese",
                price: "RM 7-15",
                images: [
                    "myfoodimages/hokkienmee1.jpg",
                    "myfoodimages/hokkienmee2.jpg"
                ],
                description: "Hokkien Mee is a stir-fried noodle dish with Fujian origins. It features thick yellow noodles stir-fried with prawns, pork slices, and vegetables, all coated in a rich, savory dark soy sauce and a flavorful meat broth.",
                recommendedPlaces: [
                    {
                        name: "Restoran Kim Lian Kee (Petaling Street)",
                        address: "92, Jalan Hang Lekir, City Centre, 50000 Kuala Lumpur",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=92+Jalan+Hang+Lekir+50000+Kuala+Lumpur"
                    }
                ]
            },
            {
                id: 9,
                name: "Apam Balik",
                ethnicity: "Malay",
                price: "RM 3-6",
                images: [
                    "myfoodimages/apambalik1.jpg",
                    "myfoodimages/apambalik2.jpg",
                    "myfoodimages/apambalik3.jpg"
                ],
                description: "Apam Balik is a traditional Malaysian pancake with a thin, crispy outer layer and a sweet filling of crushed peanuts, sugar, and creamed corn. It's a popular street-side treat perfect as a snack or dessert.",
                recommendedPlaces: [
                    {
                        name: "Taman Connaught Night Market (popular apam balik stalls)",
                        address: "Jalan Cerdas, Taman Connaught, 56000 Kuala Lumpur",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Taman+Connaught+Night+Market+Apam+Balik+Kuala+Lumpur"
                    }
                ]
            },
            {
                id: 10,
                name: "Rojak",
                ethnicity: "Indian",
                price: "RM 4-8",
                images: [
                    "myfoodimages/rojak1.jpg",
                    "myfoodimages/rojak2.jpg"
                ],
                description: "Rojak is a traditional Malaysian fruit and vegetable salad. It's a mix of different fruits, vegetables, and tofu, tossed in a unique, tangy, and spicy dressing. It's a popular, healthy, and delicious snack.",
                recommendedPlaces: [
                    {
                        name: "Rojak & Cendol SS15 Subang Jaya (Ah Chai)",
                        address: "Jalan SS15/3B, 47500 Subang Jaya, Selangor",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Rojak+and+Cendol+SS15+Subang+Jaya"
                    }
                ]
            },
            {
                id: 11,
                name: "Onde-Onde",
                ethnicity: "Malay",
                price: "RM 2-5",
                images: [
                    "myfoodimages/onde1.jpg",
                    "myfoodimages/onde2.jpg"
                ],
                description: "Onde-Onde are traditional Malaysian glutinous rice balls filled with liquid palm sugar and coated in fresh grated coconut. They have a chewy texture and burst with sweet flavor, making them a favorite dessert.",
                recommendedPlaces: [
                    {
                        name: "Baba Charlie Nyonya Cake",
                        address: "72, Lorong Tengkera Pantai 2C, 75200 Melaka",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Baba+Charlie+Nyonya+Cake+Lorong+Tengkera+Pantai+Melaka"
                    }
                ]
            },
            {
                id: 12,
                name: "Chicken Rice",
                ethnicity: "Chinese",
                price: "RM 8-15",
                images: [
                    "myfoodimages/chickenrice1.jpg",
                    "myfoodimages/chickenrice3.jpg"
                ],
                description: "Chicken Rice is a well-known Malaysian dish consisting of fragrant rice cooked with chicken broth, and served with tender steamed or roasted chicken, cucumber slices, and a special chili sauce. It's a simple yet satisfying meal.",
                recommendedPlaces: [
                    {
                        name: "Loke Yun Hainanese Chicken Rice",
                        address: "158, Jalan Besar, Pekan Ampang, 68000 Ampang, Selangor",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Loke+Yun+Hainanese+Chicken+Rice+158+Jalan+Besar+Ampang"
                    }
                ]
            },
            {
                id: 13,
                name: "Nasi Biryani",
                ethnicity: "Indian",
                price: "RM 10-25",
                images: [
                    "myfoodimages/nasibiryani1.jpg",
                    "myfoodimages/nasibiryani2.jpg"
                ],
                description: "Nasi Biryani is a flavorful rice dish where the rice is cooked with spices and turmeric, giving it a vibrant golden color and rich aroma. It's typically served with curried chicken or lamb, vegetables, and other savory sides, and is a staple in Malaysian-Indian cuisine.",
                recommendedPlaces: [
                    {
                        name: "Restoran Mahbub (Bangsar)",
                        address: "26, Lorong Ara Kiri 1, Lucky Garden, Bangsar, 59100 Kuala Lumpur",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Restoran+Mahbub+26+Lorong+Ara+Kiri+1+Bangsar"
                    }
                ]
            },
            {
                id: 14,
                name: "Wonton Mee",
                ethnicity: "Chinese",
                price: "RM 6-12",
                images: [
                    "myfoodimages/wontonmee1.jpg",
                    "myfoodimages/wontonmee2.jpg",
                    "myfoodimages/wontonmee3.jpg"
                ],
                description: "Malaysian Wonton Mee is usually a 'dry' version, with the noodles tossed in a dark soy and chili sauce, giving them a springy texture. It's served with slices of char siu (barbecued pork), wontons (fried or boiled), and vegetables. A small bowl of soup is often served on the side.",
                recommendedPlaces: [
                    {
                        name: "Meng Kee Char Siew & Wantan Mee (Kuchai Lama)",
                        address: "No. 7, Jalan Kuchai Maju 6, Off Jalan Kuchai Lama, 58200 Kuala Lumpur",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Meng+Kee+Char+Siew+Wantan+Mee+Jalan+Kuchai+Maju+6"
                    }
                ]
            },
            {
                id: 15,
                name: "Nasi Kerabu",
                ethnicity: "Malay",
                price: "RM 8-15",
                images: [
                    "myfoodimages/nasikerabu1.jpg",
                    "myfoodimages/nasikerabu2.jpg",
                    "myfoodimages/nasikerabu3.jpg"
                ],
                description: "Nasi Kerabu is a specialty from Malaysia's east coast, known for its distinct blue rice colored with butterfly pea flowers. It's served with a variety of fresh herbs, spices, grilled chicken or fried fish, salted egg, and a special chili sambal, creating a wonderfully complex and refreshing flavor profile.",
                recommendedPlaces: [
                    {
                        name: "Nasi Kerabu Panji (Kota Bharu)",
                        address: "Lot 947, Jalan Hospital, Kampung Belukar, 15000 Kota Bharu, Kelantan",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Nasi+Kerabu+Panji+Lot+947+Jalan+Hospital+Kota+Bharu"
                    }
                ]
            }
        ];

        function getCachedFilter() {
            return sessionStorage.getItem('malaysiaFoodFilter') || '';
        }
        
        function setCachedFilter(filter) {
            sessionStorage.setItem('malaysiaFoodFilter', filter);
        }

        function renderFoodCards(filteredFoods, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            container.innerHTML = '';
            
            if (filteredFoods.length === 0) {
                container.innerHTML = '<div class="text-center w-100 py-5"><p>No food found. Click "View All Foods" to see more options.</p></div>';
                return;
            }
            
            filteredFoods.forEach(food => {
                const col = document.createElement('div');
                col.className = 'col-md-6 col-lg-4';
                
                col.innerHTML = `
                    <div class="card" data-food-id="${food.id}" id="food-${food.id}">
                        <div class="position-relative card-img-container">
                            <img src="${food.images[0]}" class="card-img-top" alt="${food.name}" data-img-index="0" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iMTgiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIiBmaWxsPSIjODg4Ij5JbWFnZSBub3QgZm91bmQ8L3RleHQ+PC9zdmc+';">
                            <div class="price-tag">${food.price}</div>
                            
                            ${food.images.length > 1 ? `
                            <div class="image-nav">
                                <button class="prev-img-btn"><</button>
                                <button class="next-img-btn">></button>
                            </div>` : ''}
                        </div>
                        <div class="card-body">
                            <h5 class="food-title">${food.name}</h5>
                            <p class="mb-2">
                                <span class="fi fi-my"></span>
                                ${food.ethnicity} Cuisine 
                            </p>
                            <div class="d-flex justify-content-between align-items-center">
                                <button class="btn btn-outline-primary btn-sm toggle-details" data-food-id="${food.id}">
                                    View Details
                                </button>
                                <i class="far fa-heart like-btn" data-food-id="${food.id}"></i>
                            </div>
                        </div>
                        <div class="food-details" id="details-${food.id}">
                            <div class="p-3">
                                <p>${food.description}</p>
                                
                                ${food.recommendedPlaces ? `
                                <div class="recommended-places">
                                    <h6>Recommended Places:</h6>
                                    ${food.recommendedPlaces.map(place => `
                                        <div class="place-item">
                                            <strong>${place.name}</strong><br>
                                            <small>${place.address}</small><br>
                                            <a href="${place.mapLink}" target="_blank" class="map-link">
                                                <i class="fas fa-map-marker-alt"></i> View on Google Maps
                                            </a>
                                        </div>
                                    `).join('')}
                                </div>
                                ` : ''}
                                
                                <div class="share-btn-group">
                                    <button class="share-btn share-all-btn" data-food-id="${food.id}" data-food-name="${food.name}">
                                        <i class="fas fa-share-alt"></i> Share
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(col);
            });
        }
        function searchByEthnicity() {
            const ethnicitySelect = document.getElementById('ethnicitySelect');
            const selectedEthnicity = ethnicitySelect.value;

            setCachedFilter(selectedEthnicity);
            
            let filteredFoods = foods;
            if (selectedEthnicity) {
                filteredFoods = foods.filter(food => 
                    food.ethnicity === selectedEthnicity
                );
            }
            
            renderFoodCards(filteredFoods, 'food-container');
            attachEventListeners();
            loadLikes();
            document.getElementById('viewAllBtn').classList.add('d-none');
            document.getElementById('myFavoritesBtn').classList.remove('d-none');
        }

        function updateSectionTitle(title) {
            const titleElement = document.querySelector('.section-title');
            if (titleElement) {
            titleElement.textContent = title;
            }
        }

        function showFavorites() {
            const likes = JSON.parse(localStorage.getItem('foodLikes')) || {};
            const likedFoodIds = Object.keys(likes).map(id => parseInt(id, 10));
            const favoriteFoods = foods.filter(food => likedFoodIds.includes(food.id));
            
            renderFoodCards(favoriteFoods, 'food-container');
            attachEventListeners();
            loadLikes();
            updateSectionTitle('My Favorites Malaysian Street Food ❤️');

            document.getElementById('ethnicitySelect').classList.add('d-none');
            document.getElementById('myFavoritesBtn').classList.add('d-none');
            document.getElementById('viewAllBtn').classList.remove('d-none');
        }

        function viewAllFoods() {
        document.getElementById('ethnicitySelect').classList.remove('d-none');
        document.getElementById('myFavoritesBtn').classList.remove('d-none');
        document.getElementById('viewAllBtn').classList.add('d-none');
    
        updateSectionTitle('Malaysian Street Food');
    
        const cachedFilter = getCachedFilter();
        if (cachedFilter) {
            document.getElementById('ethnicitySelect').value = cachedFilter;
        }
        searchByEthnicity();
        }

        function loadExtraContent() {
            $.ajax({
                url: '/api/food-stats', 
                method: 'GET',
                success: function(data) {
                    console.log('Additional content loaded', data);
                },
                error: function(error) {
                    console.log('Could not load additional content', error);
                }
            });
        }

        function attachEventListeners() {
            document.querySelectorAll('.toggle-details').forEach(button => {
                button.addEventListener('click', function() {
                    const foodId = this.getAttribute('data-food-id');
                    const detailsElement = document.getElementById(`details-${foodId}`);
                    if (detailsElement.classList.contains('show')) {
                        detailsElement.classList.remove('show');
                        this.textContent = 'View Details';
                    } else {
                        detailsElement.classList.add('show');
                        this.textContent = 'Hide Details';
                    }
                });
            });

            document.querySelectorAll('.like-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const foodId = this.getAttribute('data-food-id');
                    this.classList.toggle('active');
                    this.classList.toggle('fas');
                    this.classList.toggle('far');
                    saveLike(foodId, this.classList.contains('active'));
                });
            });

            document.querySelectorAll('.card').forEach(card => {
                const foodId = parseInt(card.getAttribute('data-food-id'));
                const food = foods.find(f => f.id === foodId);

                if (!food || food.images.length <= 1) return;

                const imgElement = card.querySelector('.card-img-top');
                const prevBtn = card.querySelector('.prev-img-btn');
                const nextBtn = card.querySelector('.next-img-btn');

                if (prevBtn) {
                    prevBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        let currentIndex = parseInt(imgElement.getAttribute('data-img-index'));
                        currentIndex = (currentIndex - 1 + food.images.length) % food.images.length;
                        imgElement.src = food.images[currentIndex];
                        imgElement.setAttribute('data-img-index', currentIndex);
                    });
                }
                
                if (nextBtn) {
                    nextBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        let currentIndex = parseInt(imgElement.getAttribute('data-img-index'));
                        currentIndex = (currentIndex + 1) % food.images.length;
                        imgElement.src = food.images[currentIndex];
                        imgElement.setAttribute('data-img-index', currentIndex);
                    });
                }
            });

            document.querySelectorAll('.share-all-btn').forEach(btn => {
                btn.addEventListener('click', async function(e) {
                    e.preventDefault();
                    const foodId = this.getAttribute('data-food-id');
                    const foodName = this.getAttribute('data-food-name');
                    
                    const shareUrl = `${window.location.origin}${window.location.pathname}#food-${foodId}`;

                    if (navigator.share) {
                        try {
                            await navigator.share({
                                title: `Malaysian Food: ${foodName}`,
                                text: `Check out this delicious Malaysian food: ${foodName}!`,
                                url: shareUrl
                            });
                            console.log('Content shared successfully');
                        } catch (error) {
                            console.error('Error sharing:', error);
                        }
                    } else {
                       
                        if (navigator.clipboard) {
                            try {
                                await navigator.clipboard.writeText(shareUrl);
                                alert('Link copied to clipboard!');
                            } catch (err) {
                                console.error('Failed to copy text: ', err);
                                alert('Your browser does not support the native share function. Please copy the link manually.');
                            }
                        } else {
                            alert('Your browser does not support the native share function. Please copy the link manually: ' + shareUrl);
                        }
                    }
                });
            });
        }

        function saveLike(foodId, isLiked) {
            let likes = JSON.parse(localStorage.getItem('foodLikes')) || {};
            if (isLiked) {
                likes[foodId] = true;
            } else {
                delete likes[foodId];
            }
            localStorage.setItem('foodLikes', JSON.stringify(likes));
        }

        function loadLikes() {
            const likes = JSON.parse(localStorage.getItem('foodLikes')) || {};
            Object.keys(likes).forEach(foodId => {
                const likeBtn = document.querySelector(`.like-btn[data-food-id="${foodId}"]`);
                if (likeBtn) {
                    likeBtn.classList.add('active', 'fas');
                    likeBtn.classList.remove('far');
                }
            });
        }
        
        function scrollToFoodCard() {
            if (window.location.hash) {
                const foodId = window.location.hash.replace('#food-', '');
                const cardElement = document.querySelector(`.card[data-food-id="${foodId}"]`);
                if (cardElement) {
                    cardElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    
                    const detailsBtn = cardElement.querySelector('.toggle-details');
                    const detailsElement = cardElement.querySelector('.food-details');
                    if (detailsBtn && detailsElement && !detailsElement.classList.contains('show')) {
                        detailsBtn.click();
                    }
                }
            }
        }

        $(document).ready(function() {
            const cachedFilter = getCachedFilter();
            if (cachedFilter) {
                document.getElementById('ethnicitySelect').value = cachedFilter;
            }
            
            searchByEthnicity(); 
            
            const ethnicitySelect = document.getElementById('ethnicitySelect');
            if (ethnicitySelect) {
                ethnicitySelect.addEventListener('change', searchByEthnicity);
            }

            const myFavoritesBtn = document.getElementById('myFavoritesBtn');
            if (myFavoritesBtn) {
                myFavoritesBtn.addEventListener('click', showFavorites);
            }

            const viewAllBtn = document.getElementById('viewAllBtn');
            if (viewAllBtn) {
                viewAllBtn.addEventListener('click', viewAllFoods);
            }
            
            loadExtraContent();
            scrollToFoodCard(); 
        });
    </script>
</body>
</html>